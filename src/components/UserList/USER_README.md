# 用户管理模块

## 快速开始

### 1. 导入组件

```javascript
import UserList from '@/components/UserList';
```

### 2. 在路由中使用

```javascript
import UserList from '@/components/UserList';

// 在路由配置中
{
  path: '/users',
  element: <UserList />,
  meta: {
    title: '用户管理',
    requiresAuth: true,
    requiresAdmin: true  // 仅管理员可访问
  }
}
```

### 3. 权限配置

确保你的 Redux store 中包含用户信息：

```javascript
// Redux state 结构
{
  user: {
    currentUser: {
      userId: 1,
      userName: '张三',
      roles: ['admin']  // 必须包含 admin 角色
    }
  }
}
```

## 功能说明

### 主要功能

1. **用户列表**
   - 分页展示（默认10条/页）
   - 按创建时间排序
   - 显示用户名、姓名、角色、邮箱、电话、状态
   - 启用/禁用状态切换

2. **用户搜索**
   - 关键词搜索（用户名、姓名）
   - 按角色筛选

3. **新增用户**
   - 用户名（唯一性校验）
   - 姓名
   - 自动生成8位随机密码
   - 角色选择（多选）：
     - 管理员
     - 客户对接人
     - 摄影师
     - 后期
     - 财务
   - 邮箱（格式校验）
   - 电话（格式校验）
   - 备注

4. **编辑用户**
   - 可修改：姓名、角色、邮箱、电话、备注
   - 不可修改：用户名（避免身份混淆）

5. **重置密码**
   - 生成新的8位随机密码
   - 弹窗展示新密码
   - 支持一键复制
   - 需管理员手动告知用户

6. **启用/禁用用户**
   - 开关切换状态
   - 禁用前二次确认
   - 禁用后用户无法登录

### 权限控制

- **访问权限**：仅 `admin` 角色可访问此页面
- **操作权限**：所有操作均需管理员权限
- **安全提示**：
  - 禁用用户时显示警告提示
  - 重置密码时显示重要提示
  - 密码仅展示一次

### 表单验证

1. **用户名验证**
   - 必填
   - 3-20个字符
   - 只能包含字母、数字和下划线
   - 唯一性校验（新增时）

2. **邮箱验证**
   - 标准邮箱格式
   - 可选

3. **手机号验证**
   - 11位数字
   - 1开头
   - 可选

4. **角色验证**
   - 必须选择至少一个角色

### 密码生成规则

系统自动生成的8位随机密码包含：
- 至少1个大写字母
- 至少1个小写字母
- 至少1个数字
- 字符集：`ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%&*`
- 避免容易混淆的字符（如 0/O, 1/I/l）

## API 接口要求

用户管理模块需要以下后端 API 接口支持：

### 用户相关
- `GET /api/users` - 获取用户列表
- `GET /api/users/:id` - 获取用户详情
- `POST /api/users` - 创建用户
- `PUT /api/users/:id` - 更新用户
- `DELETE /api/users/:id` - 删除用户
- `GET /api/users/check-username` - 检查用户名是否存在
- `POST /api/users/:id/reset-password` - 重置用户密码
- `PUT /api/users/:id/status` - 更新用户状态

### 其他
- `GET /api/roles` - 获取角色列表
- `GET /api/users/operation-logs` - 获取操作日志

详细的 API 接口规范请参考 `USER_DOCUMENTATION.md`。

## 角色说明

| 角色 | 英文标识 | 权限说明 |
|------|----------|----------|
| 管理员 | admin | 系统最高权限，可访问所有功能 |
| 客户对接人 | client_manager | 管理客户、订单、任务分配 |
| 摄影师 | photographer | 查看和完成摄影任务 |
| 后期 | retoucher | 查看和完成后期任务 |
| 财务 | finance | 管理收款记录 |

## 安全特性

1. **权限控制**
   - 页面级权限：非管理员无法访问
   - 显示403无权限页面

2. **操作确认**
   - 禁用用户需二次确认
   - 显示操作影响提示

3. **密码安全**
   - 自动生成强密码
   - 密码加密存储（后端实现）
   - 重置密码后旧密码失效

4. **操作日志**
   - 记录所有用户操作
   - 包括新增、编辑、禁用、重置密码

## 使用示例

### 1. 新增用户流程

```
1. 点击"新增用户"按钮
2. 填写用户信息：
   - 用户名：zhangsan
   - 姓名：张三
   - 角色：选择"摄影师"
   - 邮箱：zhangsan@example.com
   - 电话：13800138000
3. 系统自动生成密码：Abc12345
4. 点击"创建"按钮
5. 创建成功后弹窗显示初始密码
6. 管理员将密码告知用户
```

### 2. 重置密码流程

```
1. 在用户列表中找到目标用户
2. 点击"重置密码"按钮
3. 阅读警告提示
4. 点击"确认重置"
5. 系统生成新密码并显示
6. 点击"复制密码"
7. 将新密码告知用户
```

### 3. 禁用用户流程

```
1. 在用户列表中找到目标用户
2. 关闭"启用"开关
3. 阅读确认弹窗（警告禁用后用户无法登录）
4. 点击"确认"
5. 用户状态变更为"禁用"
```

## 常见问题

### 1. 用户列表不显示数据
- 检查当前用户是否有 admin 角色
- 确认后端接口是否正常
- 查看浏览器控制台错误信息

### 2. 用户名唯一性校验失败
- 确保后端实现了用户名检查接口
- 检查接口返回格式是否正确

### 3. 密码复制功能不工作
- 检查浏览器是否支持 Clipboard API
- 确认页面是否使用 HTTPS（部分浏览器要求）

### 4. 非管理员可以访问用户管理页面
- 检查路由守卫是否正确配置
- 确认 Redux 中的用户角色数据

### 5. 重置密码后没有显示新密码
- 检查后端接口是否返回了新密码
- 查看网络请求响应数据

## 样式自定义

所有 LESS 变量都可以通过修改对应的 `.less` 文件进行自定义：

- `UserList.less` - 主容器样式
- `UserSearchBar.less` - 搜索栏样式
- `UserTable.less` - 表格样式
- `UserFormDrawer.less` - 表单抽屉样式

## 更新日志

### v1.0.0 (2025-01-05)
- 初始版本
- 完整的用户管理功能
- 用户名唯一性校验
- 自动密码生成
- 重置密码功能
- 启用/禁用功能
- 权限控制
- 操作日志记录
